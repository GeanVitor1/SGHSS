@page
@model SGHSSVidaPlus.MVC.Areas.Identity.Pages.Account.LoginModel
@using SGHSSVidaPlus.MVC.Models; // Adicione esta linha para usar RegisterPacienteViewModel

@{
    ViewData["Title"] = "Entrar / Cadastrar";
    Layout = "_LayoutLogin";
}

<section class="gradient-custom d-flex justify-content-center align-items-center" style="min-height: 100vh">
    <div class="container h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-12 col-md-10 col-lg-8 col-xl-7 mx-auto">
                <div class="card bg-white text-dark" style="border-radius: 1rem;">
                    <div class="card-body p-5 text-center">
                        <div class="mt-md-4 pb-5">

                            <img src="~/img/logo.svg" height="150" class="mb-4" />
                            <h2 class="fw-bold mb-4 text-uppercase">Bem-vindo(a) ao SGHSSVidaPlus</h2>

                            <ul class="nav nav-tabs mb-4 justify-content-center" id="myTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-content" type="button" role="tab" aria-controls="login-content" aria-selected="true">Entrar</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-content" type="button" role="tab" aria-controls="register-content" aria-selected="false">Cadastrar Paciente</button>
                                </li>
                            </ul>

                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="login-content" role="tabpanel" aria-labelledby="login-tab">
                                    <p class="text-dark-50 mb-4">Por favor, digite seu login e senha!</p>
                                    <form id="account" method="post">
                                        <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>

                                        <div class="form-floating mb-3">
                                            <input asp-for="Input.Usuario" class="form-control" autocomplete="username" type="text" aria-required="true" placeholder="Usuário" />
                                            <label asp-for="Input.Usuario" class="form-label">Usuário</label>
                                            <span asp-validation-for="Input.Usuario" class="text-danger"></span>
                                        </div>

                                        <div class="form-floating mb-3">
                                            <input asp-for="Input.Password" class="form-control" autocomplete="current-password" aria-required="true" placeholder="Senha" />
                                            <label asp-for="Input.Password" class="form-label">Senha</label>
                                            <span asp-validation-for="Input.Password" class="text-danger"></span>
                                        </div>

                                        <button class="btn btn-stantard btn-lg px-5 mt-3" type="submit">Entrar</button>
                                    </form>

                                    <div class="mt-4">
                                        <p class="mb-0">Ainda não tem conta? <a href="#" class="text-dark-50 fw-bold" onclick="showRegisterTab()">Cadastre-se aqui</a></p>
                                    </div>
                                </div>

                                <div class="tab-pane fade" id="register-content" role="tabpanel" aria-labelledby="register-tab">
                                    <p class="text-dark-50 mb-4">Preencha seus dados para criar sua conta de paciente.</p>
                                    <form id="register-patient-form" method="post" asp-action="RegisterPatient" asp-controller="Pacientes">
                                        <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input asp-for="RegisterPatientInput.Nome" class="form-control" placeholder="Nome Completo" />
                                                    <label asp-for="RegisterPatientInput.Nome"></label>
                                                    <span asp-validation-for="RegisterPatientInput.Nome" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input asp-for="RegisterPatientInput.Email" class="form-control" type="email" autocomplete="new-email" placeholder="E-mail" />
                                                    <label asp-for="RegisterPatientInput.Email"></label>
                                                    <span asp-validation-for="RegisterPatientInput.Email" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input asp-for="RegisterPatientInput.Senha" class="form-control" type="password" autocomplete="new-password" placeholder="Senha" />
                                                    <label asp-for="RegisterPatientInput.Senha"></label>
                                                    <span asp-validation-for="RegisterPatientInput.Senha" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input asp-for="RegisterPatientInput.ConfirmarSenha" class="form-control" type="password" autocomplete="new-password" placeholder="Confirmar Senha" />
                                                    <label asp-for="RegisterPatientInput.ConfirmarSenha"></label>
                                                    <span asp-validation-for="RegisterPatientInput.ConfirmarSenha" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input asp-for="RegisterPatientInput.Endereco" class="form-control" placeholder="Endereço" />
                                                    <label asp-for="RegisterPatientInput.Endereco"></label>
                                                    <span asp-validation-for="RegisterPatientInput.Endereco" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input asp-for="RegisterPatientInput.CPF" class="form-control" placeholder="CPF" />
                                                    <label asp-for="RegisterPatientInput.CPF"></label>
                                                    <span asp-validation-for="RegisterPatientInput.CPF" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input asp-for="RegisterPatientInput.DataNascimento" class="form-control" type="date" placeholder="Data de Nascimento" />
                                                    <label asp-for="RegisterPatientInput.DataNascimento"></label>
                                                    <span asp-validation-for="RegisterPatientInput.DataNascimento" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <select asp-for="RegisterPatientInput.EstadoCivil" class="form-control">
                                                        <option value="">Selecione</option>
                                                        <option value="Solteiro(a)">Solteiro(a)</option>
                                                        <option value="Casado(a)">Casado(a)</option>
                                                        <option value="Divorciado(a)">Divorciado(a)</option>
                                                        <option value="Viúvo(a)">Viúvo(a)</option>
                                                        <option value="União Estável">União Estável</option>
                                                    </select>
                                                    <label asp-for="RegisterPatientInput.EstadoCivil"></label>
                                                    <span asp-validation-for="RegisterPatientInput.EstadoCivil" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <div class="form-floating">
                                                <input asp-for="RegisterPatientInput.TipoConsultaDesejada" class="form-control" placeholder="Qual tipo de consulta você busca?" />
                                                <label asp-for="RegisterPatientInput.TipoConsultaDesejada"></label>
                                            </div>
                                        </div>


                                        <button class="btn btn-stantard btn-lg px-5 mt-3" type="submit">Cadastrar</button>

                                    </form>

                                    <div class="mt-4">
                                        <p class="mb-0">Já tem conta? <a href="#" class="text-dark-50 fw-bold" onclick="showLoginTab()">Faça login</a></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script>
        // Função para formatar o CPF
        $(document).ready(function () {
            $('#RegisterPatientInput_CPF').mask('000.000.000-00');
        });

        // Função para mostrar a aba de registro
        function showRegisterTab() {
            var registerTab = new bootstrap.Tab(document.getElementById('register-tab'));
            registerTab.show();
        }

        // Função para mostrar a aba de login
        function showLoginTab() {
            var loginTab = new bootstrap.Tab(document.getElementById('login-tab'));
            loginTab.show();
        }

        @if (!ViewData.ModelState.IsValid)
        {
            var erros = string.Join(" . ", ViewData.ModelState.Values.SelectMany(v => v.Errors).Select(e => e.ErrorMessage));
                <script>
                    // Se houver erros de validação no modelo, mostre a aba de registro
                    // Isso é útil se o usuário tentar cadastrar e falhar, para que ele veja os erros no formulário de cadastro.
                    $(document).ready(function() {
                @if (Model.RegisterPatientInput != null && !ViewData.ModelState.IsValid) // Verifica se o modelo de registro foi postado
                {
                    <text>
                                    showRegisterTab();
                                    mensagem.error('@erros', "", 10);
                    </text>
                }
                else
                {
                    <text>
                                    mensagem.error('@erros', "", 10);
                    </text>
                }
                    });
        </script>
        }
        </script>
}